<!doctype html>
<html lang="pt-br">
<head>
    {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GIRO DNC - Eventos e Vendas</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'paginas/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'paginas/css/eventos.css' %}">
</head>
<body>
  <header class="gd-topbar">
    <div class="gd-logo-container">
      <a href="{% url 'paginas:home' %}">
        <img src="{% static 'paginas/img/Girologo.jpg' %}" alt="Logo Giro" class="gd-logo">
      </a>
    </div>
    <div class="gd-topbar-content">
      <span class="gd-pill">GIRO DNC</span>
    </div>
  </header>
  <!-- Menu Sanduíche - FORA do header -->
  <div class="sidebar-item">
    <button id="sidebar-toggle" class="menu-sanduiche">
      <i class="bi bi-list"></i>
    </button>
  </div>


  <div class="gd-layout d-flex">
    <!-- Sidebar Padronizado -->
    {% with sidebar_section='eventos' sidebar_active='eventos_lista' %}
      {% include 'includes/sidebar.html' %}
    {% endwith %}

    <main class="gd-main">
      <div class="conteudo">
        <h1 class="gd-breadcrumb">Eventos / Vendas de Ingressos</h1>
        <h2 class="gd-page-title">Eventos Ativos</h2>

        <!-- Estatísticas Pessoais -->
        <div class="row mb-4">
          <div class="col-md-4">
            <div class="card border-primary">
              <div class="card-body text-center">
                <i class="bi bi-ticket-perforated display-4 text-primary"></i>
                <h3 class="mt-2">{{ total_ingressos }}</h3>
                <p class="text-muted mb-0">Total de Ingressos Vendidos</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card border-success">
              <div class="card-body text-center">
                <i class="bi bi-cash-stack display-4 text-success"></i>
                <h3 class="mt-2">R$ {{ total_comissao|floatformat:2 }}</h3>
                <p class="text-muted mb-0">Total em Comissões</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card border-info">
              <div class="card-body text-center">
                <i class="bi bi-list-check display-4 text-info"></i>
                <h3 class="mt-2">{{ minhas_vendas|length }}</h3>
                <p class="text-muted mb-0">Últimas Vendas Registradas</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de Eventos -->
        <h3 class="mb-3"><i class="bi bi-calendar-event"></i> Eventos Disponíveis</h3>
        
        {% if eventos %}
          <div class="row">
            {% for evento in eventos %}
            <div class="col-md-6 mb-4">
              <div class="card h-100 evento-card {% if evento.percentual_meta >= 100 %}border-success{% endif %}">
                {% if evento.imagem %}
                <img src="{{ evento.imagem.url }}" class="card-img-top evento-card-image" alt="{{ evento.nome }}">
                {% endif %}
                <div class="card-header bg-primary text-white card-header-evento">
                  <h5 class="mb-0"><i class="bi bi-calendar3"></i> {{ evento.nome }}</h5>
                </div>
                <div class="card-body">
                  <p><strong>Data:</strong> {{ evento.data_evento|date:"d/m/Y" }}
                    {% if evento.hora_evento %} às {{ evento.hora_evento|time:"H:i" }}{% endif %}
                  </p>
                  {% if evento.local %}
                    <p><strong>Local:</strong> {{ evento.local }}</p>
                  {% endif %}
                  <p><strong>Valor do Ingresso:</strong> R$ {{ evento.valor_ingresso|floatformat:2 }}</p>
                  {% if evento.comissao_percentual > 0 %}
                    <p><strong>Comissão:</strong> {{ evento.comissao_percentual }}% por ingresso</p>
                  {% endif %}
                  
                  {% if evento.descricao %}
                    <p class="text-muted">{{ evento.descricao|truncatewords:30 }}</p>
                  {% endif %}
                  
                  <!-- Progresso -->
                  <div class="evento-progress-container">
                    <div class="d-flex justify-content-between mb-1">
                      <span><strong>Progresso de Vendas</strong></span>
                      <span>{{ evento.total_vendido }} / {{ evento.meta_vendas }}</span>
                    </div>
                    <div class="progress progress-eventos evento-progress-bar">
                      <div class="progress-bar {% if evento.percentual_meta >= 100 %}bg-success{% elif evento.percentual_meta >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                           role="progressbar" 
                           style="width: {{ evento.percentual_meta|default:0 }}%;" 
                           aria-valuenow="{{ evento.percentual_meta }}" 
                           aria-valuemin="0" 
                           aria-valuemax="100">
                        {{ evento.percentual_meta|floatformat:0 }}%
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <a href="{% url 'paginas:evento_detalhes' evento.id %}" class="btn btn-primary w-100">
                    <i class="bi bi-plus-circle"></i> Registrar Venda
                  </a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Nenhum evento ativo no momento.
          </div>
        {% endif %}

        <!-- Últimas Vendas -->
        {% if minhas_vendas %}
        <h3 class="mt-5 mb-3"><i class="bi bi-clock-history"></i> Últimas Vendas Registradas</h3>
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>Data</th>
                <th>Evento</th>
                <th>Quantidade</th>
                <th>Valor Total</th>
                <th>Comissão</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for venda in minhas_vendas %}
              <tr>
                <td>{{ venda.data_venda|date:"d/m/Y" }}</td>
                <td>{{ venda.evento.nome }}</td>
                <td>{{ venda.quantidade }}</td>
                <td>R$ {{ venda.valor_total|floatformat:2 }}</td>
                <td><strong class="text-success">R$ {{ venda.valor_comissao|floatformat:2 }}</strong></td>
                <td>
                  {% if venda.confirmado %}
                    <span class="badge bg-success">Confirmado</span>
                  {% else %}
                    <span class="badge bg-warning">Pendente</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="text-center">
          <a href="{% url 'paginas:minhas_vendas' %}" class="btn btn-outline-primary">
            Ver Todas as Minhas Vendas <i class="bi bi-arrow-right"></i>
          </a>
        </div>
        {% endif %}

      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'paginas/js/script.js' %}"></script>
</body>
</html>
