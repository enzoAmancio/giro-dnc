<!doctype html>
<html lang="pt-br">
<head>
    {% load static %}
    {% load paginas_filters %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GIRO DNC - Horários de aula</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'paginas/css/style.css' %}">
</head>
<body>
  <header class="gd-topbar">
    <div class="gd-logo-container">
      <a href="{% url 'paginas:home' %}">
        <img src="{% static 'paginas/img/Girologo.jpg' %}" alt="Logo Giro" class="gd-logo">
      </a>
    </div>
    <div class="gd-topbar-content">
      <span class="gd-pill">GIRO DNC</span>
    </div>
  </header>
  <!-- Menu Sanduíche - FORA do header -->
  <div class="sidebar-item">
    <button id="sidebar-toggle" class="menu-sanduiche">
      <i class="bi bi-list"></i>
    </button>
  </div>


  <div class="gd-layout d-flex">
    <aside class="gd-sidebar d-flex flex-column">
      <nav class="gd-nav flex-grow-1">
        
        <div class="accordion" id="sidebarAccordion">
          <ul>
            <li>
              <div class="gd-submenu mb-1">
                <button class="btn-toggle sidebar-option" data-bs-toggle="collapse" data-bs-target="#collapseAluno" aria-expanded="true">
                  <i class="bi bi-person-circle"></i>
                  <span>Painel do aluno</span>
                  <i class="bi bi-chevron-down ms-auto"></i>
                </button>
                <div class="collapse show" id="collapseAluno" data-bs-parent="#sidebarAccordion">
                  <a href="{% url 'paginas:painel_index' %}" class="nav-link sidebar-option">
                    <i class="bi bi-speedometer2"></i>
                    <span>Visão Geral</span>
                  </a>
                  <a href="{% url 'paginas:painel_horarios' %}" class="nav-link sidebar-option active">
                    <i class="bi bi-clock"></i>
                    <span>Horários de aula</span>
                  </a>
                  <a href="{% url 'paginas:painel_avisos' %}" class="nav-link sidebar-option">
                    <i class="bi bi-bell"></i>
                    <span>Avisos</span>
                  </a>
                </div>
              </div>
            </li>
            <li>
              <div class="gd-submenu mb-2">
                <button class="btn-toggle sidebar-option" data-bs-toggle="collapse" data-bs-target="#collapseFinanceiro">
                  <i class="bi bi-cash-stack"></i>
                  <span>Financeiro</span>
                  <i class="bi bi-chevron-down ms-auto"></i>
                </button>
                <div class="collapse" id="collapseFinanceiro" data-bs-parent="#sidebarAccordion">
                  <a href="{% url 'paginas:financeiro_mensalidades' %}" class="nav-link sidebar-option">
                    <img src="{% static 'paginas/img/Mensalidades.png' %}" alt="Mensalidades" class="sidebar-icon">
                    <span>Mensalidades</span>
                  </a>
                  <a href="{% url 'paginas:financeiro_extrato' %}" class="nav-link sidebar-option">
                    <img src="{% static 'paginas/img/extraroFinanceiro.png' %}" alt="ExtratoFinanceiro" class="sidebar-icon">
                    <span>Extrato Financeiro</span>
                  </a>
                  <a href="{% url 'paginas:financeiro_despesas' %}" class="nav-link sidebar-option">
                    <img src="{% static 'paginas/img/Despesas.png' %}" alt="DespesasGiro" class="sidebar-icon">
                    <span>Despesas Giro</span>
                  </a>
                </div>
              </div>
            </li>
            <li>
              <div class="gd-submenu mb-2">
                <button class="btn-toggle sidebar-option" data-bs-toggle="collapse" data-bs-target="#collapseEventos">
                  <i class="bi bi-ticket-perforated"></i>
                  <span>Eventos</span>
                  <i class="bi bi-chevron-down ms-auto"></i>
                </button>
                <div class="collapse" id="collapseEventos" data-bs-parent="#sidebarAccordion">
                  <a href="{% url 'paginas:eventos_lista' %}" class="nav-link sidebar-option">
                    <i class="bi bi-calendar-event"></i>
                    <span>Eventos Ativos</span>
                  </a>
                  <a href="{% url 'paginas:minhas_vendas' %}" class="nav-link sidebar-option">
                    <i class="bi bi-graph-up"></i>
                    <span>Minhas Vendas</span>
                  </a>
                </div>
              </div>
            </li>
            <li>
              <div class="gd-submenu mb-2">
                <button class="btn-toggle sidebar-option" data-bs-toggle="collapse" data-bs-target="#collapseAulas">
                  <i class="bi bi-journal-bookmark"></i>
                  <span>Minhas aulas</span>
                  <i class="bi bi-chevron-down ms-auto"></i>
                </button>
                <div class="collapse" id="collapseAulas" data-bs-parent="#sidebarAccordion">
                  <a href="{% url 'paginas:painel_minhas_aulas' %}" class="nav-link sidebar-option"><i class="bi bi-book"></i><span>Minhas aulas</span></a>
                </div>
              </div>
            </li>
            <li>
              <div class="gd-submenu mb-3">
                <button class="btn-toggle sidebar-option" data-bs-toggle="collapse" data-bs-target="#collapseComunicacao">
                  <i class="bi bi-chat-left-text"></i>
                  <span>Comunicação</span>
                  <i class="bi bi-chevron-down ms-auto"></i>
                </button>
                <div class="collapse" id="collapseComunicacao" data-bs-parent="#sidebarAccordion">
                  <a href="{% url 'paginas:painel_comunicacao' %}" class="nav-link sidebar-option"><i class="bi bi-envelope"></i><span>Converse conosco</span></a>
                  <a href="{% url 'paginas:painel_chat' %}" class="nav-link sidebar-option"><i class="bi bi-chat-dots"></i><span>Chat</span></a>
                </div>
              </div>
            </li>
            <li>
              <a href="{% url 'paginas:logout' %}" class="btn-toggle sidebar-option logout-btn">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sair</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <main class="gd-main">
      <div class="conteudo">
        <h1 class="gd-breadcrumb">Painel do aluno / Horários de aula</h1>
        <h2 class="gd-page-title">Horários de aula</h2>
        
        {% if erro %}
          <div class="alert alert-danger">{{ erro }}</div>
        {% else %}
          
          <!-- Próximas Aulas -->
          {% if proximas_aulas %}
          <div class="mb-5">
            <h3 class="mb-3"><i class="bi bi-calendar-event"></i> Próximas Aulas</h3>
            <div class="row">
              {% for aula in proximas_aulas %}
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="card border-primary">
                  <div class="card-header bg-primary text-white">
                    <i class="bi bi-calendar3"></i> {{ aula.data|date:"d/m/Y (l)" }}
                  </div>
                  <div class="card-body">
                    <h5 class="card-title">{{ aula.turma.modalidade|upper }}</h5>
                    <p class="mb-1"><strong>Turma:</strong> {{ aula.turma.nome }}</p>
                    <p class="mb-1"><strong>Horário:</strong> {{ aula.hora_inicio|time:"H:i" }} - {{ aula.hora_fim|time:"H:i" }}</p>
                    {% if aula.tema %}
                      <p class="mb-1"><strong>Tema:</strong> {{ aula.tema }}</p>
                    {% endif %}
                    {% if aula.conteudo %}
                      <p class="mb-0"><small>{{ aula.conteudo|truncatewords:20 }}</small></p>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Grade de Horários Recorrentes -->
          <div class="mb-5">
            <h3 class="mb-3"><i class="bi bi-clock-history"></i> Grade de Horários</h3>
            {% if horarios_por_dia %}
              <div class="horarios-container">
                {% for dia in dias_semana %}
                  {% for horario in horarios_por_dia|get_item:dia %}
                    <div class="horario-card">
                      <div class="horario-topo">{{ dia }}</div>
                      <div class="horario-info">
                        <span>{{ horario.hora_inicio|time:"H:i" }} - {{ horario.hora_fim|time:"H:i" }}</span>
                        <div class="horario-aula">
                          <span class="horario-nome">{{ horario.turma.modalidade|upper }} - {{ horario.turma.nome }}</span>
                          <span class="horario-prof">
                            {% if horario.turma.professor %}
                              com {{ horario.turma.professor.get_full_name|default:horario.turma.professor.username }}
                            {% else %}
                              Professor não definido
                            {% endif %}
                          </span>
                          {% if horario.sala %}
                            <span class="horario-sala"><i class="bi bi-geo-alt"></i> {{ horario.sala }}</span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                {% endfor %}
              </div>
            {% else %}
              <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> Você ainda não está matriculado em nenhuma turma com horários cadastrados.
              </div>
            {% endif %}
          </div>

          <!-- Vídeos das Últimas Aulas -->
          {% if aulas_com_video %}
          <div class="mb-4">
            <h3 class="mb-3"><i class="bi bi-play-circle"></i> Vídeos das Últimas Aulas</h3>
            <div class="row">
              {% for aula in aulas_com_video %}
              <div class="col-md-6 mb-4">
                <div class="card">
                  <div class="card-header bg-success text-white">
                    <i class="bi bi-camera-video"></i> {{ aula.turma.nome }} - {{ aula.data|date:"d/m/Y" }}
                  </div>
                  <div class="card-body p-0">
                    <video controls class="w-100" style="max-height: 400px;">
                      <source src="{{ aula.video.url }}" type="video/mp4">
                      Seu navegador não suporta vídeos HTML5.
                    </video>
                  </div>
                  <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        {% if aula.tema %}
                          <strong>{{ aula.tema }}</strong><br>
                        {% endif %}
                        <small class="text-muted">
                          {{ aula.hora_inicio|time:"H:i" }} - {{ aula.hora_fim|time:"H:i" }}
                          {% if aula.get_video_size_mb %}
                            | {{ aula.get_video_size_mb|floatformat:1 }} MB
                          {% endif %}
                        </small>
                      </div>
                      <a href="{{ aula.video.url }}" download class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-download"></i> Baixar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

        {% endif %}
      </div>
    </main>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'paginas/js/script.js' %}"></script>
</body>
</html>